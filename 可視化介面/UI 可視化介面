
### uiæ§åˆ¶ä»‹é¢

1. **R1ã€L1ã€R2ã€L2 æ§åˆ¶**ï¼š
   - R1/L1ï¼šæ§åˆ¶å¤¾çˆªçš„é–‹åˆã€‚
   - R2/L2ï¼šæ§åˆ¶å¤¾çˆªçš„ä¸Šä¸‹ç§»å‹•ã€‚

2. **PS5 æ–æ¡¿ API**ï¼š
   - æä¾›æ–æ¡¿æŒ‰éµã€è»¸å€¼çš„è®€å–ç¯„ä¾‹ã€‚

---

###  (rov_ui.py)
```python
import sys
import random
import numpy as np
import pygame
from PyQt6.QtWidgets import (
    QApplication, QMainWindow, QLabel, QVBoxLayout, QWidget,
    QProgressBar, QDockWidget
)
from PyQt6.QtCore import QTimer, Qt
from PyQt6.QtGui import QFont
from matplotlib.figure import Figure
from matplotlib.backends.backend_qtagg import FigureCanvasQTAgg as FigureCanvas
from mpl_toolkits.mplot3d import Axes3D
from collections import deque


class ROV_UI(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("ROV ç«¶è³½æ§åˆ¶é¢æ¿ - å°ˆæ¥­ç‰ˆ")
        self.setGeometry(50, 50, 1920, 1080)

        # åˆå§‹åŒ– pygameï¼ˆåµæ¸¬æ–æ¡¿ï¼‰
        pygame.init()
        pygame.joystick.init()

        # å˜—è©¦é€£æ¥ PS5 æ–æ¡¿
        self.joystick = None
        if pygame.joystick.get_count() > 0:
            self.joystick = pygame.joystick.Joystick(0)
            self.joystick.init()
            print(f"å·²é€£æ¥æ–æ¡¿: {self.joystick.get_name()}")
        else:
            print("æœªæª¢æ¸¬åˆ°æ–æ¡¿ï¼Œå•Ÿç”¨æ¨¡æ“¬æ¨¡å¼")

        # åˆå§‹åŒ–æ¨¡æ“¬æ•¸æ“š
        self.simulated_data = {
            "depth": 0.0,  # æ·±åº¦ (m)
            "voltage": 48.0,  # é›»å£“ (V)
            "battery": 100.0,  # é›»æ± é›»é‡ (%)
            "imu": (0.0, 0.0, 0.0),  # Pitch, Roll, Yaw
            "gripper": {"up_down": 90, "left_right": 90, "open_close": 90}  # å¤¾çˆªè§’åº¦
        }

        # å„²å­˜æ­·å²æ•¸æ“š
        self.data_history = {
            "depth": deque(maxlen=100),
            "voltage": deque(maxlen=100),
            "battery": deque(maxlen=100),
            "imu_x": deque(maxlen=100),
            "imu_y": deque(maxlen=100),
            "imu_z": deque(maxlen=100)
        }

        self.main_widget = QWidget()
        self.setCentralWidget(self.main_widget)
        self.main_layout = QVBoxLayout()
        self.main_widget.setLayout(self.main_layout)

        self.init_docking_ui()

        # è¨­å®šè¨ˆæ™‚å™¨ï¼ˆæ¯ 100ms æ›´æ–°æ•¸æ“šï¼‰
        self.timer = QTimer(self)
        self.timer.timeout.connect(self.update_data)
        self.timer.start(100)

    def create_label(self, text):
        """å»ºç«‹æ¨™ç±¤"""
        label = QLabel(text)
        label.setFont(QFont("Arial", 20))
        return label

    def init_docking_ui(self):
        """å»ºç«‹ Docking ä»‹é¢"""
        self.data_dock = QDockWidget("ğŸ“Š å³æ™‚æ•¸æ“šç›£æ¸¬", self)
        self.data_dock.setWidget(self.create_data_page())
        self.addDockWidget(Qt.DockWidgetArea.LeftDockWidgetArea, self.data_dock)

        self.chart_dock = QDockWidget("ğŸ“ˆ IMU 3D åœ–è¡¨", self)
        self.chart_dock.setWidget(self.create_chart_page())
        self.addDockWidget(Qt.DockWidgetArea.BottomDockWidgetArea, self.chart_dock)

    def create_data_page(self):
        """å»ºç«‹å³æ™‚æ•¸æ“šç›£æ¸¬å€åŸŸ"""
        page = QWidget()
        layout = QVBoxLayout()

        self.depth_label = self.create_label("ğŸŒŠ æ·±åº¦ (m): --")
        self.voltage_label = self.create_label("ğŸ”‹ é›»å£“ (V): --")
        self.battery_label = self.create_label("âš¡ é›»æ± å®¹é‡ (%): --")
        self.imu_label = self.create_label("ğŸ›ï¸ IMU: Pitch: --Â°, Roll: --Â°, Yaw: --Â°")
        self.gripper_label = self.create_label("ğŸ¤– å¤¾çˆª: ä¸Šä¸‹: --Â°, å·¦å³: --Â°, é–‹åˆ: --Â°")

        labels = [self.depth_label, self.voltage_label, self.battery_label, self.imu_label, self.gripper_label]
        for label in labels:
            layout.addWidget(label)

        self.battery_bar = QProgressBar()
        self.battery_bar.setMinimum(0)
        self.battery_bar.setMaximum(100)
        self.battery_bar.setFixedHeight(50)
        layout.addWidget(self.battery_bar)

        page.setLayout(layout)
        return page

    def create_chart_page(self):
        """å»ºç«‹ IMU 3D åœ–è¡¨"""
        page = QWidget()
        layout = QVBoxLayout()

        self.fig = Figure(figsize=(10, 8))
        self.canvas = FigureCanvas(self.fig)
        self.ax_imu = self.fig.add_subplot(111, projection="3d")

        layout.addWidget(self.canvas)
        page.setLayout(layout)
        return page

    def update_data(self):
        """ğŸ“Š æ›´æ–°æ•¸æ“š"""
        pygame.event.pump()  # æ›´æ–° pygame äº‹ä»¶

        # æ–æ¡¿æˆ–éµç›¤æ§åˆ¶
        if self.joystick:
            pitch = self.joystick.get_axis(1) * 30
            roll = self.joystick.get_axis(0) * 30
            yaw = self.joystick.get_axis(2) * 180

            # ä½¿ç”¨ R1/L1 æ§åˆ¶å¤¾çˆªé–‹åˆ
            if self.joystick.get_button(5):  # R1
                self.simulated_data["gripper"]["open_close"] += 5
            if self.joystick.get_button(4):  # L1
                self.simulated_data["gripper"]["open_close"] -= 5

            # ä½¿ç”¨ R2/L2 æ§åˆ¶å¤¾çˆªä¸Šä¸‹ç§»å‹•
            r2 = self.joystick.get_axis(5)  # R2 è»¸å€¼
            l2 = self.joystick.get_axis(4)  # L2 è»¸å€¼
            self.simulated_data["gripper"]["up_down"] += int(r2 * 5)
            self.simulated_data["gripper"]["up_down"] -= int(l2 * 5)
        else:
            keys = pygame.key.get_pressed()
            pitch = (keys[pygame.K_w] - keys[pygame.K_s]) * 30
            roll = (keys[pygame.K_a] - keys[pygame.K_d]) * 30
            yaw = (keys[pygame.K_q] - keys[pygame.K_e]) * 180

            # éµç›¤æ§åˆ¶å¤¾çˆª
            self.simulated_data["gripper"]["up_down"] += (keys[pygame.K_i] - keys[pygame.K_k]) * 5
            self.simulated_data["gripper"]["left_right"] += (keys[pygame.K_j] - keys[pygame.K_l]) * 5
            self.simulated_data["gripper"]["open_close"] += (keys[pygame.K_u] - keys[pygame.K_o]) * 5

        # é™åˆ¶å¤¾çˆªè§’åº¦ç¯„åœ
        for key in self.simulated_data["gripper"]:
            self.simulated_data["gripper"][key] = np.clip(self.simulated_data["gripper"][key], 0, 180)

        # æ¨¡æ“¬æ•¸æ“šæ›´æ–°
        self.simulated_data["depth"] = np.clip(self.simulated_data["depth"] + np.random.uniform(-0.5, 0.5), 0, 50)
        self.simulated_data["voltage"] = np.clip(self.simulated_data["voltage"] - np.random.uniform(0, 0.1), 45, 50)
        self.simulated_data["battery"] = max(0, self.simulated_data["battery"] - np.random.uniform(0, 0.3))
        self.simulated_data["imu"] = (pitch, roll, yaw)

        for key in ["depth", "voltage", "battery"]:
            self.data_history[key].append(self.simulated_data[key])

        self.data_history["imu_x"].append(self.simulated_data["imu"][0])
        self.data_history["imu_y"].append(self.simulated_data["imu"][1])
        self.data_history["imu_z"].append(self.simulated_data["imu"][2])

        # æ›´æ–°ä»‹é¢
        self.depth_label.setText(f"ğŸŒŠ æ·±åº¦ (m): {self.simulated_data['depth']:.2f}")
        self.voltage_label.setText(f"ğŸ”‹ é›»å£“ (V): {self.simulated_data['voltage']:.2f}")
        self.battery_label.setText(f"âš¡ é›»æ± å®¹é‡ (%): {self.simulated_data['battery']:.1f}")
        self.imu_label.setText(f"ğŸ›ï¸ IMU: Pitch: {self.simulated_data['imu'][0]:.1f}Â°, "
                               f"Roll: {self.simulated_data['imu'][1]:.1f}Â°, "
                               f"Yaw: {self.simulated_data['imu'][2]:.1f}Â°")
        self.gripper_label.setText(f"ğŸ¤– å¤¾çˆª: ä¸Šä¸‹: {self.simulated_data['gripper']['up_down']}Â°, "
                                   f"å·¦å³: {self.simulated_data['gripper']['left_right']}Â°, "
                                   f"é–‹åˆ: {self.simulated_data['gripper']['open_close']}Â°")

        self.battery_bar.setValue(int(self.simulated_data["battery"]))

        self.update_chart()

    def update_chart(self):
        """æ›´æ–° IMU 3D åœ–è¡¨"""
        self.ax_imu.clear()
        self.ax_imu.scatter(self.data_history["imu_x"], self.data_history["imu_y"], self.data_history["imu_z"], c="red", marker="o")
        self.ax_imu.set_xlabel("Pitch (Â°)")
        self.ax_imu.set_ylabel("Roll (Â°)")
        self.ax_imu.set_zlabel("Yaw (Â°)")
        self.canvas.draw()


app = QApplication(sys.argv)
window = ROV_UI()
window.show()
sys.exit(app.exec())
```

---

### PS5 æ–æ¡¿ API ç¯„ä¾‹

1. **æŒ‰éµæª¢æ¸¬**ï¼š
   - `joystick.get_button(button_id)`ï¼šæª¢æ¸¬æŒ‰éµæ˜¯å¦è¢«æŒ‰ä¸‹ã€‚
     - `button_id=4`ï¼šL1
     - `button_id=5`ï¼šR1

2. **è»¸å€¼æª¢æ¸¬**ï¼š
   - `joystick.get_axis(axis_id)`ï¼šç²å–è»¸å€¼ï¼ˆç¯„åœï¼š-1.0 ~ 1.0ï¼‰ã€‚
     - `axis_id=4`ï¼šL2
     - `axis_id=5`ï¼šR2

---
ä»¥ä¸‹æ˜¯æ•´ç†å¾Œçš„ **UI å¯è¦–åŒ–ä»‹é¢èˆ‡é€šè¨Š** èªªæ˜ï¼ŒåŒ…å«åŠŸèƒ½ã€åŸ·è¡Œæ–¹å¼èˆ‡æ³¨æ„äº‹é …ã€‚

---

### åŠŸèƒ½æè¿°

1. **æ–æ¡¿æ§åˆ¶**ï¼š
   - **R1/L1**ï¼šæ§åˆ¶å¤¾çˆªçš„é–‹åˆã€‚
   - **R2/L2**ï¼šæ§åˆ¶å¤¾çˆªçš„ä¸Šä¸‹ç§»å‹•ã€‚
   - **å·¦æ–æ¡¿ X è»¸**ï¼šæ§åˆ¶å¤¾çˆªçš„å·¦å³æ—‹è½‰ã€‚

2. **æ•¸æ“šé¡¯ç¤º**ï¼š
   - å³æ™‚é¡¯ç¤º ROV çš„æ·±åº¦ã€é›»å£“ã€é›»æ± ç‹€æ…‹ã€‚
   - é¡¯ç¤º IMU æ•¸æ“šï¼ˆPitch, Roll, Yawï¼‰ã€‚
   - é¡¯ç¤ºå¤¾çˆªçš„ç•¶å‰è§’åº¦ï¼ˆä¸Šä¸‹ã€å·¦å³ã€é–‹åˆï¼‰ã€‚

3. **é€šè¨Šæ–¹å¼**ï¼š
   - ä½¿ç”¨ä¸²å£ï¼ˆUSB/UARTï¼‰èˆ‡ Arduino é€šè¨Šï¼Œå‚³è¼¸æ§åˆ¶æŒ‡ä»¤èˆ‡æ¥æ”¶å›å‚³æ•¸æ“šã€‚

---

### PS5 æ–æ¡¿ API ç¯„ä¾‹

1. **æŒ‰éµæª¢æ¸¬**ï¼š
   - `joystick.get_button(button_id)`ï¼šæª¢æ¸¬æŒ‰éµæ˜¯å¦è¢«æŒ‰ä¸‹ã€‚
     - `button_id=4`ï¼šL1
     - `button_id=5`ï¼šR1

2. **è»¸å€¼æª¢æ¸¬**ï¼š
   - `joystick.get_axis(axis_id)`ï¼šç²å–è»¸å€¼ï¼ˆç¯„åœï¼š-1.0 ~ 1.0ï¼‰ã€‚
     - `axis_id=4`ï¼šL2
     - `axis_id=5`ï¼šR2

---

### æ–°å¢åŠŸèƒ½

1. **R1/L1 æ§åˆ¶å¤¾çˆªé–‹åˆ**ã€‚
2. **R2/L2 æ§åˆ¶å¤¾çˆªä¸Šä¸‹ç§»å‹•**ã€‚
3. **å³æ™‚é¡¯ç¤ºå¤¾çˆªç‹€æ…‹**ã€‚

---

### åŸ·è¡Œæ–¹å¼

1. å®‰è£å¿…è¦çš„ Python å¥—ä»¶ï¼š
   ```bash
   pip install PyQt6 matplotlib pygame numpy
   ```

2. å°‡ç¨‹å¼ç¢¼ä¿å­˜ç‚º `rov_ui.py`ï¼Œç„¶å¾ŒåŸ·è¡Œï¼š
   ```bash
   python3 rov_ui.py
   ```

---

### æ³¨æ„äº‹é …

1. **æ–æ¡¿æŒ‰éµèˆ‡è»¸å€¼**ï¼š
   - æ–æ¡¿æŒ‰éµå’Œè»¸å€¼çš„æ˜ å°„å¯èƒ½å› è¨­å‚™ä¸åŒè€Œæœ‰æ‰€å·®ç•°ï¼Œè«‹ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ¸¬è©¦æŒ‰éµå’Œè»¸å€¼ï¼š
     ```bash
     python3 -m pygame.examples.joystick
     ```

2. **ä¸²å£é€šè¨Š**ï¼š
   - ç¢ºä¿ Arduino èˆ‡é›»è…¦çš„ä¸²å£é€£æ¥æ­£å¸¸ï¼Œä¸¦ç¢ºèªä¸²å£åç¨±ï¼ˆå¦‚ `/dev/ttyACM0`ï¼‰ã€‚
   - å¦‚æœç„¡æ³•é€šè¨Šï¼Œè«‹æª¢æŸ¥ä¸²å£æ¬Šé™ï¼š
     ```bash
     sudo usermod -a -G dialout $USER
     ```

3. **ä¼ºæœé¦¬é”è§’åº¦ç¯„åœ**ï¼š
   - ä¼ºæœé¦¬é”çš„è§’åº¦ç¯„åœæ‡‰é™åˆ¶åœ¨ `0Â° ~ 180Â°`ï¼Œé¿å…è¶…å‡ºç‰©ç†é™åˆ¶å°è‡´æå£ã€‚

4. **åŸ·è¡Œç¨‹å¼**ï¼š
   - ç¢ºä¿ç¨‹å¼ç¢¼ä¿å­˜ç‚ºæ­£ç¢ºçš„æª”æ¡ˆåç¨±ï¼ˆå¦‚ `rov_ui.py`ï¼‰ï¼Œä¸¦ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤åŸ·è¡Œï¼š
     ```bash
     python3 rov_ui.py
     ```

5. **é™¤éŒ¯å·¥å…·**ï¼š
   - ä½¿ç”¨ `print` æˆ– `logging` åœ¨ç¨‹å¼ä¸­è¼¸å‡ºèª¿è©¦ä¿¡æ¯ï¼Œæ–¹ä¾¿æª¢æŸ¥æ–æ¡¿è¼¸å…¥èˆ‡ä¼ºæœé¦¬é”æ§åˆ¶æ˜¯å¦æ­£å¸¸ã€‚

6. **ç³»çµ±è³‡æº**ï¼š
   - å¦‚æœç³»çµ±è³‡æºä¸è¶³ï¼ˆå¦‚ CPU æˆ–è¨˜æ†¶é«”ï¼‰ï¼Œå¯èƒ½å°è‡´ UI æ›´æ–°å»¶é²æˆ–å¡é “ï¼Œå»ºè­°é—œé–‰å…¶ä»–ä¸å¿…è¦çš„ç¨‹å¼ã€‚

7. **æ¨¡æ“¬æ¨¡å¼**ï¼š
   - å¦‚æœæœªæª¢æ¸¬åˆ°æ–æ¡¿ï¼Œç¨‹å¼æœƒå•Ÿç”¨æ¨¡æ“¬æ¨¡å¼ï¼Œè«‹æª¢æŸ¥æ–æ¡¿é€£æ¥æˆ–ä½¿ç”¨éµç›¤é€²è¡Œæ¸¬è©¦ã€‚

8. **å®‰å…¨æ€§**ï¼š
   - åœ¨æ¸¬è©¦ä¼ºæœé¦¬é”æ™‚ï¼Œç¢ºä¿å‘¨åœç„¡éšœç¤™ç‰©ï¼Œé¿å…å› é¦¬é”é‹å‹•å°è‡´æå£æˆ–å±éšªã€‚

---

æ­¤æ•´ç†æœ‰åŠ©æ–¼ç¢ºä¿ UI ä»‹é¢èˆ‡æ–æ¡¿æ§åˆ¶åŠŸèƒ½çš„ç©©å®šæ€§èˆ‡å¯é æ€§ï¼Œé©ç”¨æ–¼æ°´ä¸‹æ©Ÿå™¨äººï¼ˆROVï¼‰çš„é–‹ç™¼èˆ‡æ¸¬è©¦ç’°å¢ƒã€‚